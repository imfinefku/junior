<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<script src="/js/jquery-1.10.1.min.js"></script>
<script src="/js/jquery.cookie.js"></script>
<script src="/layui/layui.js"></script>
<link rel="stylesheet" href="/layui/css/layui.css">
<title>狂人日记</title>
</head>
<body class="layui-layout-body">
	<div class="layui-layout layui-layout-admin">
		<div class="layui-header">
			<div class="layui-logo">狂人日记</div>
			<!-- 头部区域（可配合layui已有的水平导航） -->
			<ul class="layui-nav layui-layout-left" id="topMenu">
			</ul>
			<ul class="layui-nav layui-layout-right">
				<li class="layui-nav-item"><a href="javascript:;"> <img
						src="/manager.jpg" class="layui-nav-img"> <span id="nickname"></span>
				</a>
					<dl class="layui-nav-child">
						<dd>
							<a href="">修改密码</a>
						</dd>
						<dd>
							<a href="javascript:logout()">退出</a>
						</dd>
					</dl></li>
			</ul>
		</div>

		<div class="layui-side layui-bg-black">
			<div class="layui-side-scroll">
				<!-- 左侧导航区域（可配合layui已有的垂直导航） -->
				<ul class="layui-nav layui-nav-tree" id="leftTree">
				</ul>
			</div>
		</div>

		<div class="layui-body" id="content" style="background-color:#f2f2f2;"></div>
		<div class="layui-footer">
			<!-- 底部固定区域 -->
			© layui.com - 底部固定区域
		</div>
	</div>
</body>
<script>
	var menuList = null;
	var element = null;
	window.onload = function() {
		layui.use('element', function() {
			element = layui.element;
		});
		$("#nickname").html($.cookie("name"));
		setMenu();
		setContent("/html/control.html");
	};

	function setMenu() {
		menuList = JSON.parse($.cookie("menu"));
		var topMenu = "";
		for (var i = 0; i < menuList.length; i++) {
			var data = menuList[i];
			if (data.level == 1) {
				topMenu += "<li class='layui-nav-item'><a href=\"javascript:setChildMenu('"
						+ data.link
						+ "','"
						+ data.id
						+ "')\">"
						+ data.name
						+ "</a></li>";
			}
		}
		$("#topMenu").html(topMenu);
	}

	function setChildMenu(url, id) {
		if (url != "") {
			setContent(url);
		}
		var childMenu = "";
		for (var i = 0; i < menuList.length; i++) {
			var firstChild = true;
			if (menuList[i].pid == id) {
				childMenu += "<li class='layui-nav-item'><a href=\"javascript:setContent('"
						+ menuList[i].link
						+ "')\">"
						+ menuList[i].name
						+ "</a>";
				for (var j = 0; j < menuList.length; j++) {
					if (menuList[j].pid == menuList[i].id) {
						if (firstChild) {
							childMenu += "<dl class=\"layui-nav-child\">";
							firstChild = false;
						}
						childMenu += "<dd><a href=\"javascript:setContent('"
								+ menuList[j].link + "')\">" + menuList[j].name
								+ "</a></dd>";
					}
				}
				if (!firstChild) {
					childMenu += "</dl>";
				}
				childMenu += "</li>";
			}
		}
		$("#leftTree").html(childMenu);
		//重新渲染
		element.init();
	}

	function setContent(url) {
		if (url != "") {
			$("#content").load(url);
		}
	}

	function logout() {
		$.ajax({
			url : "/logout",
			dataType : "json",
			data : {},
			success : function(response) {
				if (response.code == "200") {
					window.location = "login.html";
				} else {
					alert(response.message);
				}
			},
			error : function(error) {
			}
		});
	}
</script>
</html>
