<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans" 
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
       xmlns:p="http://www.springframework.org/schema/p" 
       xsi:schemaLocation="http://www.springframework.org/schema/beans 
       http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
       http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd">  
    
    <!-- 指定spring读取properties配置文件 -->
    <context:property-placeholder location="config.properties"  />
    
    <!-- 数据源 -->
    <bean id="dataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource">
        <property name="driverClassName" value="com.mysql.jdbc.Driver" />
        <property name="url" value="${dbUrl}" />
        <property name="username" value="${dbUsername}" />
        <property name="password" value="${dbPassword}" />
    </bean>
    <!-- 创建SqlSessionFactory，同时指定数据源和mapper -->  
    <bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean"> 
        <property name="dataSource" ref="dataSource"/> 
    </bean>  
    <bean id="sqlSession" class="org.mybatis.spring.SqlSessionTemplate"> 
        <constructor-arg index="0" ref="sqlSessionFactory"/> 
    </bean>  
    <!-- spring与mybatis整合配置，扫描所有dao -->  
    <bean class="org.mybatis.spring.mapper.MapperScannerConfigurer"> 
        <property name="basePackage" value="com.base.dao"/> 
    </bean>  
    <!-- Dao -->
    <bean id="springBeanFactoryUtils" class="com.base.util.SpringBeanFactoryUtils" scope="singleton" />

    <!-- ================================= 事务控制相关 ============================================= -->  
    <bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager"> 
        <property name="dataSource" ref="dataSource"/> 
    </bean>  
    <bean name="transactionIterceptor" class="org.springframework.transaction.interceptor.TransactionInterceptor"> 
        <property name="transactionManager" ref="transactionManager"/>  
        <property name="transactionAttributes"> 
            <props> 
                <!-- 凡是涉及DML(Data Manipulation Language)语句的方法， 要求事�传播属性为REQUIRED REQUIRED含义：
                如果无事务，新建；如果有，加入。 -->  
                <prop key="insert*">PROPAGATION_REQUIRED</prop>  
                <!-- �：delete*方��的参数： +java.lang.RuntimeException代表忽略此��法运行时产生的RuntimeException， 
                仍然��够提交，适用于出错日志的数据�久化。 如果写为：-Exception，代表不忽略任何异常，全部回滚。 -->  
                <prop key="delete*">PROPAGATION_REQUIRED</prop>  
                <prop key="update*">PROPAGATION_REQUIRED</prop>  
                <!-- 其他语句�以考虑传播属性为SUPPORTS SUPPORTS含义：如果无事务，不新建；如果有，加入。 -->  
<!--                 <prop key="find*">PROPAGATION_SUPPORTS</prop>   -->
<!--                 <prop key="get*">PROPAGATION_SUPPORTS</prop>   -->
<!--                 <prop key="select*">PROPAGATION_SUPPORTS</prop>  -->
            </props> 
        </property> 
    </bean>  
    <!-- AOP方�将事务拦截器织入到需要的结构中 -->  
    <bean class="org.springframework.aop.framework.autoproxy.BeanNameAutoProxyCreator"> 
        <property name="beanNames"> 
            <!--下面的List中的参数为要求被事务管理器管理的Spring bean的名称 -->  
            <list> 
                <value>*Service</value> 
            </list> 
        </property>  
        <property name="interceptorNames"> 
            <list> 
                <!-- 使用的事务拦截器 -->  
                <value>transactionIterceptor</value> 
            </list> 
        </property> 
    </bean>  
    <!--ResponseBody返回值修改编码 -->  
    <bean class="org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter"> 
        <property name="messageConverters"> 
            <list> 
                <ref bean="stringHttpMessageConverter"/> 
            </list> 
        </property> 
    </bean>  
    <bean id="stringHttpMessageConverter" class="org.springframework.http.converter.StringHttpMessageConverter"> 
        <property name="supportedMediaTypes"> 
            <list> 
                <value>text/html;charset=UTF-8</value> 
            </list> 
        </property> 
    </bean>
</beans>
